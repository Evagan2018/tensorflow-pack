name: "TensorFlow Lite Micro Unit tests"
workdir: ./
backend:
  aws:
    ami-version: ==1.2.3
    instance-type: c5.4xlarge
upload:
  - gen/**/*
  - out/**/*
  - Layer/**/*
  - Project/**/*
  - Source/**/*
  - avh_exec_test.py
  - exec_suite.sh
  - record_test_results.py

steps:
  - run: |
     wget https://github.com/Open-CMSIS-Pack/devtools/releases/download/tools%2Ftoolbox%2F1.0.0/cmsis-toolbox.sh
     chmod +x cmsis-toolbox.sh
     cat <<EOF >>cmsis.in
     /opt/ctools
     /home/ubuntu/packs
     /opt/armcompiler/bin/


     /root/gcc-arm-11.2-2022.02-x86_64-arm-none-eabi/bin]: /opt/gcc-arm-11.2-2022.02-x86_64-arm-none-eabi/bin/


     EOF
     ./cmsis-toolbox.sh < cmsis.in
     source /opt/ctools/etc/setup
     cpackget -v init --pack-root /home/ubuntu/packs https://www.keil.com/pack/index.pidx
     cpackget pack add tensorflow.tensorflow-lite-micro.1.22.5-rc4 -a
     cpackget pack add tensorflow.flatbuffers.1.22.5-rc4 -a
     cpackget pack add tensorflow.ruy.1.22.5-rc4 -a
     cpackget pack add tensorflow.gemmlowp.1.22.5-rc4 -a
     cpackget pack add tensorflow.kissfft.1.22.5-rc4 -a
     cpackget pack add Keil.V2M-MPS2_CMx_BSP.1.8.0 -a
     cpackget pack add Keil.V2M-IOTKit_BSP.1.5.0 -a
     cpackget pack add Keil.V2M-MPS2_IOTKit_BSP.1.5.0 -a
     cpackget pack add ARM.V2M_MPS3_SSE_300_BSP.1.3.0 -a

     ./exec_suite.sh > test_results.log 2>&1

download:
  - test_results.db
  - test_results.log


